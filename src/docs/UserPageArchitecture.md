# ä¸ªäººé¡µé¢ç¼–è¾‘ç³»ç»Ÿ - æ¶æ„è¯´æ˜

## ğŸ“‹ æ•°æ®æµæ¶æ„

### 1. **ç”¨æˆ·é¡µé¢æ•°æ®è·å–**
- **æ˜¾ç¤ºç”¨æˆ·é¡µé¢**: ç›´æ¥ä» `/api/v2/me/` å“åº”ä¸­çš„ `page` å­—æ®µè·å–
- **ç¼–è¾‘ç”¨æˆ·é¡µé¢**: ä½¿ç”¨ `/api/v2/users/{id}/page` æ¥å£è¿›è¡Œæ›´æ–°

### 2. **API æ¥å£è¯´æ˜**

#### ğŸ“– é¡µé¢å†…å®¹è·å–
```typescript
// ä»ç”¨æˆ·å¯¹è±¡è·å–é¡µé¢æ•°æ®
const userPage = user.page; // { html: string, raw: string }
```

#### âœï¸ é¡µé¢å†…å®¹ç¼–è¾‘
```typescript
// æ›´æ–°é¡µé¢å†…å®¹
await userAPI.updateUserPage(userId, content);
// è¿”å›: { html: string }
```

#### âœ… BBCode éªŒè¯
```typescript
// å®æ—¶éªŒè¯BBCodeè¯­æ³•
await userAPI.validateBBCode(content);
// è¿”å›: { valid: boolean, errors: string[], preview: { html: string, raw: string } }
```

### 3. **ç»„ä»¶æ•°æ®æµ**

```
UserPage.tsx (ç®¡ç†ç”¨æˆ·çŠ¶æ€)
    â†“
UserProfileLayout.tsx (é›†æˆé¡µé¢æ˜¾ç¤ºå’Œç¼–è¾‘)
    â†“
UserPageDisplay.tsx (æ˜¾ç¤º) â†â†’ UserPageEditor.tsx (ç¼–è¾‘)
    â†“                              â†“
user.page å­—æ®µ                  BBCodeEditor.tsx
```

### 4. **çŠ¶æ€ç®¡ç†**

1. **UserPage**: ç»´æŠ¤å®Œæ•´çš„ç”¨æˆ·å¯¹è±¡çŠ¶æ€
2. **UserProfileLayout**: ç®¡ç†ç¼–è¾‘æ¨¡å¼åˆ‡æ¢
3. **UserPageDisplay**: ç›´æ¥ä» `user.page` è¯»å–å†…å®¹
4. **UserPageEditor**: 
   - åˆå§‹åŒ–æ—¶ä» `user.page.raw` è·å–å†…å®¹
   - ä¿å­˜æ—¶è°ƒç”¨ API æ›´æ–°
   - ä¿å­˜æˆåŠŸåé€šè¿‡å›è°ƒæ›´æ–°çˆ¶ç»„ä»¶çš„ç”¨æˆ·çŠ¶æ€

### 5. **å…³é”®å®ç°ç»†èŠ‚**

#### âœ¨ ä¼˜åŒ–ç‚¹
- **å‡å°‘APIè°ƒç”¨**: æ˜¾ç¤ºæ—¶ä¸éœ€è¦é¢å¤–çš„APIè¯·æ±‚
- **å®æ—¶åŒæ­¥**: ç¼–è¾‘ä¿å­˜åç«‹å³æ›´æ–°æœ¬åœ°çŠ¶æ€
- **ä¸€è‡´æ€§**: ç¡®ä¿æ˜¾ç¤ºå’Œç¼–è¾‘ä½¿ç”¨ç›¸åŒçš„æ•°æ®æº

#### ğŸ”„ æ•°æ®åŒæ­¥æµç¨‹
1. ç”¨æˆ·è®¿é—®é¡µé¢ â†’ è·å–ç”¨æˆ·æ•°æ®ï¼ˆåŒ…å« `page` å­—æ®µï¼‰
2. æ˜¾ç¤ºé¡µé¢å†…å®¹ â†’ ç›´æ¥ä½¿ç”¨ `user.page.html`
3. ç‚¹å‡»ç¼–è¾‘ â†’ ä» `user.page.raw` åˆå§‹åŒ–ç¼–è¾‘å™¨
4. ä¿å­˜æ›´æ”¹ â†’ è°ƒç”¨ç¼–è¾‘API â†’ æ›´æ–°æœ¬åœ°ç”¨æˆ·çŠ¶æ€
5. è¿”å›æ˜¾ç¤ºæ¨¡å¼ â†’ æ˜¾ç¤ºæ›´æ–°åçš„å†…å®¹

### 6. **API è§„èŒƒå¯¹åº”**

æ ¹æ®æä¾›çš„APIæ–‡æ¡£ï¼š

- âœ… `GET /api/v2/users/{user_id}/page` - ä»…ç”¨äºç¼–è¾‘æ—¶è·å–æœ€æ–°å†…å®¹
- âœ… `PUT /api/v2/users/{user_id}/page` - æ›´æ–°ç”¨æˆ·é¡µé¢å†…å®¹
- âœ… `POST /api/v2/me/validate-bbcode` - BBCodeè¯­æ³•éªŒè¯

ç”¨æˆ·é¡µé¢å†…å®¹çš„ä¸»è¦æ¥æºæ˜¯ `/api/v2/me/` å“åº”ä¸­çš„ `page` å­—æ®µï¼š

```json
{
  "page": {
    "html": "<processed-html-content>",
    "raw": "[bbcode]åŸå§‹BBCodeå†…å®¹[/bbcode]"
  }
}
```

### 7. **æµ‹è¯•å’Œè°ƒè¯•**

ä½¿ç”¨ `UserPageTestPage.tsx` å¯ä»¥ï¼š
- æµ‹è¯•ä¸‰ç§æ¨¡å¼ï¼šæ˜¾ç¤ºã€ç¼–è¾‘ã€BBCodeç¼–è¾‘å™¨
- æŸ¥çœ‹ç”¨æˆ·é¡µé¢æ•°æ®ç»“æ„
- éªŒè¯ä¿å­˜åçš„æ•°æ®åŒæ­¥
- è°ƒè¯•BBCodeéªŒè¯å’Œé¢„è§ˆåŠŸèƒ½

## ğŸ¯ æ€»ç»“

è¿™ä¸ªæ¶æ„ç¡®ä¿äº†ï¼š
1. **æ€§èƒ½ä¼˜åŒ–**: å‡å°‘ä¸å¿…è¦çš„APIè°ƒç”¨
2. **æ•°æ®ä¸€è‡´æ€§**: ç»Ÿä¸€çš„æ•°æ®æºå’Œæ›´æ–°æœºåˆ¶
3. **ç”¨æˆ·ä½“éªŒ**: å®æ—¶é¢„è§ˆå’Œå³æ—¶åé¦ˆ
4. **å¯ç»´æŠ¤æ€§**: æ¸…æ™°çš„ç»„ä»¶èŒè´£åˆ†ç¦»